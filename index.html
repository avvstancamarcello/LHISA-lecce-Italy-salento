<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LHI Lecce NFT - Un Valore Reale per la Ricerca</title>
    <meta name="description" content="Sostieni la ricerca acquistando un NFT LHI, un valore digitale ancorato a un bene immobiliare da 10 milioni di euro.">
    <!-- Ethers.js -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.10.0/dist/ethers.umd.min.js" defer></script>
    <!-- MetaMask SDK -->
    <script src="https://unpkg.com/@metamask/sdk/dist/metamask-sdk.umd.js"></script>
    <!-- ABI del contratto -->
    <script src="abi.js"></script>
    <style>
        html { scroll-behavior: smooth; }
        body { background-color: #f0fff0; font-family: Arial, sans-serif; padding: 15px; color: #333; }
        .container { max-width: 900px; margin: 0 auto; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1, h2, h3 { text-align: center; color: #00796b; }
        h1 { font-size: 1.8em; }
        h2 { font-size: 1.4em; font-weight: normal; }
        h3 { font-size: 1.2em; }
        a { color: #00796b; font-weight: bold; text-decoration: none; }
        a:hover { text-decoration: underline; }
        .header, .footer-header { padding-bottom: 15px; margin-bottom: 20px; border-bottom: 1px solid #ccc; }
        .header a, .footer-header a { margin: 0 15px; }
        .banner img { width: 100%; height: auto; border-radius: 8px; margin-bottom: 20px; }
        .image-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 25px 0; }
        .image-row img { width: 100%; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .text-box { background-color: #e8f5e9; color: magenta; padding: 5px 20px; margin: 25px 0; border-radius: 8px; line-height: 1.6; }
        .text-box h3 { color: #004d40; text-align: left; }
        .minting-section { text-align: center; padding: 30px; background-color: #f0f7f8; margin-top: 30px; border-radius: 12px; }
        .nft-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px; margin-top: 20px; }
        .nft-card { text-align: center; border: 1px solid #b2dfdb; border-radius: 8px; padding: 15px; background-color: #fafafa; }
        .nft-card img { max-width: 100%; height: auto; border-radius: 5px; }
        .nft-card p { font-weight: bold; margin: 10px 0 5px 0; color: #004d40; }
        .mint-controls { margin-top: 10px; }
        .mint-controls input { width: 60px; padding: 8px; text-align: center; border: 1px solid #ccc; border-radius: 4px; margin-bottom: 10px; }
        .mint-button { width: 100%; padding: 8px 15px; font-size: 14px; cursor: pointer; background-color: #00796b; color: white; border: none; border-radius: 5px; }
        .mint-button:disabled { background-color: #aaa; cursor: not-allowed; }
        .global-wallet-section { margin-top: 40px; text-align: center; }
        #connect-btn { padding: 12px 25px; font-size: 18px; cursor: pointer; background-color: #004d40; color: white; border: none; border-radius: 5px; }
        #connect-btn:disabled { background-color: #6c757d; }
        #log { margin-top: 15px; font-style: italic; font-weight: bold; }
        .warning { color: #d32f2f; font-weight: bold; margin-bottom: 15px; border: 1px solid #ffcdd2; padding: 10px; border-radius: 5px; background-color: #ffebed;}
        .about-us-section { margin-top: 40px; padding-top: 20px; border-top: 1px solid #ccc; text-align: left; }
        .about-us-section h2 { text-align: center; }
        .about-us-section ul { list-style: none; padding: 0; }
        .about-us-section li { margin-bottom: 5px; }
        .footer { text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid #ccc; font-size: 0.9em; color: #555; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>LHI LECCE MEDICAL HOTEL ITALIA</h1>
        <h2><a href="https://lhilecce.it" target="_blank">Sito Ufficiale</a> | <a href="https://polygonscan.com/address/0x2A4974aaDFFcFbe721A0B9f41059f6D62fdaface" target="_blank">Smart Contract Verificato</a></h2>
        <h1>Token NFT Solidali - Progetto Scientifico: DEPRESSIONE: Cura e Guarigione</h1>
    </div>

    <div class="banner">
        <img src="images/banner.png" alt="Banner LHI Lecce">
    </div>

    <div class="text-box">
        <h3>Un Progetto Reale, un Valore Tangibile</h3>
        <p>A differenza di molti progetti digitali, il valore di un NFT LHI non √® astratto. √à direttamente collegato a un <strong>bene immobile e reale del valore di 10 milioni di euro</strong>: la nostra struttura a Lecce.</p>
    </div>

    <div class="image-row">
        <img src="images/05.jpg" alt="NFT 5"><img src="images/10.jpg" alt="NFT 10"><img src="images/15.jpg" alt="NFT 15"><img src="images/20.jpg" alt="NFT 20">
    </div>

    <div class="text-box">
        <h3>Un Valore Destinato a Crescere nel Benessere</h3>
        <p>Il valore del tuo NFT √® destinato a crescere con l'eccellenza dei servizi offerti. LHI vuole essere anche un <strong>centro di sollievo dalla sofferenza</strong>, offrendo una piscina con acqua di mare e servizi di alto livello.</p>
    </div>

    <div class="image-row">
        <img src="images/25.jpg" alt="NFT 25"><img src="images/30.jpg" alt="NFT 30"><img src="images/35.jpg" alt="NFT 35"><img src="images/40.jpg" alt="NFT 40">
    </div>

    <div class="text-box">
        <h3>La Nostra Zecca Digitale: Sicurezza e Affidabilit√†</h3>
        <p>Il nostro Smart Contract agisce come una <strong>Zecca Digitale</strong>. √à costruito sulla blockchain Polygon usando gli strumenti pi√π robusti e moderni, garantendo che ogni NFT sia irripetibile, non falsificabile, non duplicabile.</p>
    </div>

    <div class="image-row">
        <img src="images/45.jpg" alt="NFT 45"><img src="images/50.jpg" alt="NFT 50"><img src="images/55.jpg" alt="NFT 55"><img src="images/60.jpg" alt="NFT 60">
    </div>

    <div class="text-box">
        <h3>Il Tuo NFT: Bene Unico con Certificato di Propriet√†</h3>
        <p>Quando clicchi "Mint", la nostra Zecca Digitale crea un bene virtuale solo per te. Ogni "Mint" genera un "Certificato di Nascita" (la transazione sulla blockchain) e un "Certificato di Residenza" (la propriet√† dell‚ÄôNFT nel tuo wallet).</p>
    </div>

    <div class="image-row">
        <img src="images/65.jpg" alt="NFT 65"><img src="images/70.jpg" alt="NFT 70"><img src="images/75.jpg" alt="NFT 75"><img src="images/80.jpg" alt="NFT 80">
    </div>

    <div class="text-box">
        <h3>Un Progetto per la Ricerca Scientifica</h3>
        <p>Acquistando un NFT, non solo entri in possesso di un asset digitale di valore, ma finanzi direttamente la ricerca scientifica su Depressione e Fibromialgia, contribuendo a un obiettivo di interesse collettivo.</p>
    </div>

    <div class="image-row">
        <img src="images/85.jpg" alt="NFT 85"><img src="images/90.jpg" alt="NFT 90"><img src="images/95.jpg" alt="NFT 95"><img src="images/100.jpg" alt="NFT 100">
    </div>

    <div class="footer-header">
        <h2><a href="https://lhilecce.it" target="_blank">Sito Ufficiale LHI LECCE</a> | <a href="https://polygonscan.com/address/0x2a4364c0E9fc125D831257b289b70b0B16A02315" target="_blank">Smart Contract Polygon</a></h2>
    </div>

    <div class="about-us-section">
        <h2>Chi Siamo</h2>
        <p><strong>LHI √® una Societ√† per Azioni</strong> iscritta alla Camera di Commercio di Lecce - Italia con il n. REA LE - 210133.</p>
        <p><strong>Propriet√† LHI Spa</strong>, sede Via Giorgio di Lecce, nr 7 LECCE, n. iscr. Reg. Imprese 03223970751.</p>
        <p>La gestione della struttura immobiliare √® affidata a <strong>Santa Rita Gestioni Spa</strong>, con sede in Maglie (LE), Piazza della Repubblica nr 15 (n. iscrizione 04732500758).</p>
        <h3>Team e Collaboratori</h3>
        <ul>
            <li><strong>Presidente del CdA:</strong> Dott.ssa Cinzia Colizzi (Dottore Commercialista)</li>
            <li><strong>Responsabile dei lavori:</strong> dott. Antonio Primiceri</li>
            <li><strong>Direttore dei Lavori:</strong> ing. Donato Nocco, ing. Pietro Licignano, ing. Roberto Paladini</li>
            <li><strong>Coordinatore Sicurezza Esecuzione:</strong> ing. Roberto Paladini</li>
            <li><strong>Progettisti Architettonici:</strong> arch. Angelo Ingrosso, ing. Pietro Licignano</li>
            <li><strong>Progettisti Strutture:</strong> ing. Donato Nocco e ing. Livio Calo'</li>
            <li><strong>Progettisti Impianti:</strong> p.ti ind.li Antonio Laurenti, Piero Romano, Giuseppe Serafino, Sandro Ciurlia, Giuseppe Martella</li>
            <li><strong>Collaudatori:</strong> ing. Vito Morciano, ing. Giuseppe Bruno</li>
        </ul>
        <h3>Partner Finanziari e Contributi</h3>
        <p>Il progetto √® stato realizzato con il contributo della <strong>Regione Puglia programma Operativo Puglia FESR 2014-2020</strong>, <strong>Monte dei Paschi Siena, Capital Service di Firenze</strong> e altri partner.</p>
    </div>

    <div class="minting-section">
        <h2>Acquista il Tuo NFT</h2>
        <div class="global-wallet-section">
            <p class="warning">‚ö† IMPORTANTE: Ora puoi collegare il tuo wallet MetaMask oppure crearne uno nuovo tramite email/social! Controlla di avere MATIC sufficienti a coprire il costo dell'NFT pi√π le commissioni di gas.</p>
            <button id="connect-btn">üîó Connetti Wallet</button>
            <p id="log">Status: In attesa di connessione...</p>
        </div>
        <div class="nft-grid" id="nft-grid-container"></div>
    </div>

    <footer class="footer">
        <p>&copy; 2025 Web Master Avv. Marcello Stanca - Firenze. Tutti i diritti riservati.</p>
        <p>Realizzato in collaborazione con AI Gemini di Google (Giugno 2025).</p>
    </footer>
</div>

<script>
    // === CONFIGURAZIONE CONTRATTO E NFT ===
    const contractAddress = "0x2A4974aaDFFcFbe721A0B9f41059f6D62fdaface";
    const contractABI = window.CONTRACT_ABI;
    if (!contractABI) {
        alert("ABI non caricata! Controlla che abi.js sia referenziato e che window.CONTRACT_ABI sia definita.");
    }
    const nfts = Array.from({ length: 20 }, (_, i) => {
        const tokenId = (i + 1) * 5;
        return { id: tokenId };
    });

    let userAccount, contractInstance, provider, signer, ethereum;

    const logElement = document.getElementById('log');
    function updateLog(message, isError = false) {
        logElement.textContent = `Status: ${message}`;
        logElement.style.color = isError ? '#d32f2f' : '#333';
    }

    // === INTEGRAZIONE METAMASK SDK (EMBEDDED WALLET) ===

    // Inizializza MetaMaskSDK
    const MMSDK = new MetaMaskSDK.MetaMaskSDK({
        dappMetadata: {
            name: "LHI Lecce NFT",
            url: "https://lhilecce.it"
        },
        infura: {
            projectId: "c690c86b64b74bd5a69ad2d32cf2a0c6",
            secret: "191ee4595c3f64ace26522bcc7c5725a41c929aea1b77cfa6f0ae5ee978a3ff7"
        },
        embeddedWallet: {
            enabled: true,
            clientId: "BPOZFh3Z8-D35OCK2tAPyeybjWmNA_GAlJ2pw-MSxZlDcMeit73G0PXEVE-EF9GWrX7DSpxktOulSTEuh4cR0fs"
        }
    });
    ethereum = MMSDK.getProvider();

    async function connectWallet() {
        updateLog("Connessione al wallet...");
        try {
            // Chiede account (apre flusso onboarding Embedded se serve)
            const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
            userAccount = accounts[0];
            provider = new ethers.BrowserProvider(ethereum);
            signer = await provider.getSigner();
            contractInstance = new ethers.Contract(contractAddress, contractABI, signer);

            const connectBtn = document.getElementById('connect-btn');
            connectBtn.textContent = `Connesso: ${userAccount.substring(0, 6)}...`;
            connectBtn.disabled = true;
            document.querySelectorAll('.mint-button').forEach(btn => { btn.disabled = false; });
            updateLog("Wallet connesso.", false);
        } catch (err) {
            updateLog("Connessione fallita.", true);
            alert("Connessione fallita: " + (err.message || err));
        }
    }

    async function mintNFT(tokenId) {
        const quantityInput = document.getElementById(`quantity-${tokenId}`);
        const quantity = parseInt(quantityInput.value);
        if (!contractInstance) {
            return alert("Per favore, connetti prima il tuo wallet.");
        }
        if (isNaN(quantity) || quantity <= 0) {
            return alert("Per favore, inserisci una quantit√† valida.");
        }
        const mintButton = document.getElementById(`mint-btn-${tokenId}`);
        mintButton.disabled = true;
        mintButton.textContent = "In corso...";
        updateLog(`Preparazione transazione per ${quantity} NFT (ID: ${tokenId})...`);
        try {
            const priceInWei = await contractInstance.pricesInWei(tokenId);
            const totalCostInWei = priceInWei * BigInt(quantity);
            const tx = await contractInstance.mintNFT(tokenId, quantity, { value: totalCostInWei });
            updateLog(`Transazione inviata (hash: ${tx.hash.substring(0, 10)}...). Attendi conferma...`);
            await tx.wait();
            updateLog(`NFT ${tokenId} mintato con successo!`, false);
            alert(`Complimenti! Hai mintato ${quantity} NFT (ID: ${tokenId}).`);
        } catch (err) {
            const errorMessage = err.cause?.reason || err.info?.error?.message || err.message || "Errore sconosciuto";
            updateLog(`Errore: ${errorMessage}`, true);
            alert(`Errore durante il minting: ${errorMessage}`);
        } finally {
            mintButton.disabled = false;
            mintButton.textContent = "Mint";
        }
    }

    window.onload = function() {
        const gridContainer = document.getElementById('nft-grid-container');
        nfts.forEach(nft => {
            const card = document.createElement('div');
            card.className = 'nft-card';
            const paddedId = nft.id.toString().padStart(2, '0');
            card.innerHTML = `
                <img src="images/${paddedId}.jpg" alt="LHI NFT ${nft.id}">
                <p>LHI ${nft.id}</p>
                <div class="mint-controls">
                    <input type="number" id="quantity-${nft.id}" value="1" min="1" max="100">
                    <button class="mint-button" id="mint-btn-${nft.id}" onclick="mintNFT(${nft.id})" disabled>Mint</button>
                </div>
            `;
            gridContainer.appendChild(card);
        });

        document.getElementById('connect-btn').addEventListener('click', connectWallet);
    };
</script>
</body>
</html>
